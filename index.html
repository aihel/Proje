<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flappy Bird Math Edition - 7th Grade</title>
<style>
body{
    margin:0;
    background:black;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    color:white;
    font-family:'Arial', sans-serif;
    user-select:none;
}
canvas{
    border-radius:15px;
    box-shadow:0 0 25px rgba(0,255,255,0.3);
}
#questionBox{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.92);
    display:none;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    gap:30px;
    text-align:center;
    color:white;
    font-size:1.5em;
    z-index:100;
    backdrop-filter:blur(5px);
}
#questionText{
    color:#00ffff;
    text-shadow:0 0 10px cyan, 0 0 20px blue;
    max-width:600px;
    padding:20px;
    background:rgba(0,0,0,0.7);
    border-radius:15px;
    border:2px solid cyan;
    box-shadow:0 0 30px rgba(0,255,255,0.3);
}
#options{
    display:flex;
    gap:20px;
    flex-wrap:wrap;
    justify-content:center;
    margin:20px 0;
}
button.option{
    padding:20px 35px;
    border:none;
    border-radius:50px;
    cursor:pointer;
    font-size:2em;
    font-weight:bold;
    background:black;
    color:#ff00ff;
    border:3px solid #ff00ff;
    box-shadow:0 0 20px magenta, 0 0 40px rgba(255,0,255,0.3);
    transition:0.3s;
    min-width:120px;
}
button.option:hover{
    transform:scale(1.1);
    background:#ff00ff;
    color:black;
    box-shadow:0 0 30px magenta, 0 0 60px hotpink;
}
#solution{
    color:#ffff00;
    text-shadow:0 0 10px yellow, 0 0 20px orange;
    font-size:1.2em;
    background:rgba(0,0,0,0.5);
    padding:15px 30px;
    border-radius:10px;
    border:1px solid yellow;
    max-width:500px;
}
.soru-sayac{
    position:fixed;
    top:20px;
    right:20px;
    background:rgba(0,0,0,0.8);
    color:#00ff00;
    padding:10px 20px;
    border-radius:30px;
    border:2px solid #00ff00;
    box-shadow:0 0 15px lime;
    font-weight:bold;
    z-index:101;
}
</style>
</head>
<body>
<div class="soru-sayac" id="soruSayac">Kalan Soru: 100</div>
<canvas id="canvas" width="500" height="700"></canvas>
<div id="questionBox">
    <h2 id="questionText"></h2>
    <div id="options"></div>
    <p id="solution"></p>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

/* =============== IMAGES =============== */
function load(name){ const img=new Image(); img.src="sprites/"+name; return img; }
const bg = load("background-day.png");
const baseImg = load("base.png");
const pipeImg = load("pipe-green.png");
const birdFrames = [load("yellowbird-upflap.png"),load("yellowbird-midflap.png"),load("yellowbird-downflap.png")];
const messageImg = load("message.png");
const gameoverImg = load("gameover.png");
const scoreSprites = {"0":load("00000.png"),"1":load("111.png"),"2":load("99999.png"),"3":load("33.png"),"4":load("44.png"),"5":load("55.png"),"6":load("66.png"),"7":load("77.png"),"8":load("88.png"),"9":load("99.png")};

/* =============== 7. SINIF DOÄRU-TERS ORANTI SORULARI =============== */
const questions = [
    {q: "3 kg elma 24 TL ise 5 kg elma kaÃ§ TL'dir?", ans: "40", sol: "DoÄŸru orantÄ±: 3/24 = 5/x â†’ x = (24Ã—5)/3 = 40 TL"},
    {q: "Bir araÃ§ 4 saatte 320 km yol alÄ±yorsa, 7 saatte kaÃ§ km yol alÄ±r?", ans: "560", sol: "DoÄŸru orantÄ±: 4/320 = 7/x â†’ x = (320Ã—7)/4 = 560 km"},
    {q: "2 defter 18 TL ise 6 defter kaÃ§ TL'dir?", ans: "54", sol: "DoÄŸru orantÄ±: 2/18 = 6/x â†’ x = (18Ã—6)/2 = 54 TL"},
    {q: "5 kalem 30 TL ise 9 kalem kaÃ§ TL'dir?", ans: "54", sol: "DoÄŸru orantÄ±: 5/30 = 9/x â†’ x = (30Ã—9)/5 = 54 TL"},
    {q: "8 metre kumaÅŸ 120 TL ise 3 metre kumaÅŸ kaÃ§ TL'dir?", ans: "45", sol: "DoÄŸru orantÄ±: 8/120 = 3/x â†’ x = (120Ã—3)/8 = 45 TL"},
    {q: "4 iÅŸÃ§i bir iÅŸi 9 gÃ¼nde bitiriyor. AynÄ± iÅŸi 6 iÅŸÃ§i kaÃ§ gÃ¼nde bitirir?", ans: "6", sol: "Ters orantÄ±: 4Ã—9 = 6Ã—x â†’ x = (4Ã—9)/6 = 6 gÃ¼n"},
    {q: "Bir musluk havuzu 8 saatte dolduruyor. AynÄ± havuzu 2 musluk kaÃ§ saatte doldurur?", ans: "4", sol: "Ters orantÄ±: 1Ã—8 = 2Ã—x â†’ x = 8/2 = 4 saat"},
    {q: "5 usta bir duvarÄ± 12 gÃ¼nde Ã¶rÃ¼yor. 3 usta aynÄ± duvarÄ± kaÃ§ gÃ¼nde Ã¶rer?", ans: "20", sol: "Ters orantÄ±: 5Ã—12 = 3Ã—x â†’ x = (5Ã—12)/3 = 20 gÃ¼n"},
    {q: "2 traktÃ¶r tarlayÄ± 15 saatte sÃ¼rÃ¼yor. 5 traktÃ¶r aynÄ± tarlayÄ± kaÃ§ saatte sÃ¼rer?", ans: "6", sol: "Ters orantÄ±: 2Ã—15 = 5Ã—x â†’ x = (2Ã—15)/5 = 6 saat"},
    {q: "6 iÅŸÃ§i bir iÅŸi 8 gÃ¼nde bitiriyor. 4 iÅŸÃ§i aynÄ± iÅŸi kaÃ§ gÃ¼nde bitirir?", ans: "12", sol: "Ters orantÄ±: 6Ã—8 = 4Ã—x â†’ x = (6Ã—8)/4 = 12 gÃ¼n"},
    {q: "Bir otobÃ¼s 80 km/s hÄ±zla 6 saatte gittiÄŸi yolu, 120 km/s hÄ±zla kaÃ§ saatte gider?", ans: "4", sol: "Ters orantÄ±: 80Ã—6 = 120Ã—x â†’ x = (80Ã—6)/120 = 4 saat"},
    {q: "15 kg portakaldan 9 kg suyu Ã§Ä±kÄ±yorsa, 25 kg portakaldan kaÃ§ kg su Ã§Ä±kar?", ans: "15", sol: "DoÄŸru orantÄ±: 15/9 = 25/x â†’ x = (9Ã—25)/15 = 15 kg"},
    {q: "Bir fabrikada 12 makine 30 dakikada 360 Ã¼rÃ¼n Ã¼retiyor. AynÄ± makinelerle 20 dakikada kaÃ§ Ã¼rÃ¼n Ã¼retilir?", ans: "240", sol: "DoÄŸru orantÄ±: 30/360 = 20/x â†’ x = (360Ã—20)/30 = 240 Ã¼rÃ¼n"},
    {q: "3 kg fÄ±ndÄ±k 150 TL ise 500 TL'ye kaÃ§ kg fÄ±ndÄ±k alÄ±nÄ±r?", ans: "10", sol: "DoÄŸru orantÄ±: 3/150 = x/500 â†’ x = (3Ã—500)/150 = 10 kg"},
    {q: "Bir havuzu 4 musluk 9 saatte dolduruyor. 6 musluk aynÄ± havuzu kaÃ§ saatte doldurur?", ans: "6", sol: "Ters orantÄ±: 4Ã—9 = 6Ã—x â†’ x = (4Ã—9)/6 = 6 saat"},
    {q: "10 iÅŸÃ§i bir iÅŸi 15 gÃ¼nde yapÄ±yor. Ä°ÅŸÃ§i sayÄ±sÄ± 5 artÄ±rÄ±lÄ±rsa iÅŸ kaÃ§ gÃ¼nde biter?", ans: "10", sol: "Ters orantÄ±: 10Ã—15 = 15Ã—x â†’ x = (10Ã—15)/15 = 10 gÃ¼n"},
    {q: "Bir dikdÃ¶rtgenin boyu 12 cm, eni 8 cm'dir. Boy 4 cm azaltÄ±lÄ±rsa alanÄ±n aynÄ± kalmasÄ± iÃ§in en kaÃ§ cm artÄ±rÄ±lmalÄ±?", ans: "4", sol: "Ters orantÄ±: 12Ã—8 = 8Ã—(8+x) â†’ x = 4 cm"},
    {q: "240 sayfa kitabÄ± 15 gÃ¼nde okuyan bir kiÅŸi, aynÄ± hÄ±zla 400 sayfayÄ± kaÃ§ gÃ¼nde okur?", ans: "25", sol: "DoÄŸru orantÄ±: 240/15 = 400/x â†’ x = (15Ã—400)/240 = 25 gÃ¼n"},
    {q: "Bir araÃ§ 90 km/s hÄ±zla 8 saatte gittiÄŸi yolu, 120 km/s hÄ±zla kaÃ§ saatte gider?", ans: "6", sol: "Ters orantÄ±: 90Ã—8 = 120Ã—x â†’ x = (90Ã—8)/120 = 6 saat"},
    {q: "2 kg undan 3 kg ekmek yapÄ±lÄ±yorsa, 5 kg undan kaÃ§ kg ekmek yapÄ±lÄ±r?", ans: "7.5", sol: "DoÄŸru orantÄ±: 2/3 = 5/x â†’ x = (3Ã—5)/2 = 7.5 kg"}
];

/* =============== GAME STATE =============== */
let gameState = "menu"; // menu, playing, gameover
let bird = {
    x: 100,
    y: 300,
    vy: 0,
    frame: 0,
    width: 50,
    height: 40
};
let pipes = [];
let score = 0;
let askedQuestions = new Set();
let currentQuestion = null;
let awaitingQuestion = false;
let pipeInterval = null;
let gameLoopRunning = true;
let animationFrame = null;

const GRAVITY = 0.35;
const JUMP_POWER = -6;
const PIPE_GAP = 140;
const PIPE_WIDTH = 60;

/* =============== AUDIO =============== */
const bgm = new Audio("88.m4a");
bgm.loop = true;

/* =============== SORU SAYACI =============== */
function updateQuestionCounter() {
    const kalan = questions.length - askedQuestions.size;
    document.getElementById("soruSayac").innerText = `Kalan Soru: ${kalan}`;
    document.getElementById("soruSayac").style.color = kalan < 20 ? '#ff0000' : (kalan < 50 ? '#ffff00' : '#00ff00');
}

/* =============== INPUT =============== */
canvas.addEventListener("click", () => {
    if(gameState === "menu") {
        startGame();
    } else if(gameState === "playing") {
        bird.vy = JUMP_POWER;
    }
});

/* =============== GAME FUNCTIONS =============== */
function startGame() {
    gameState = "playing";
    bird.y = 300;
    bird.vy = 0;
    pipes = [];
    score = 0;
    bgm.play();
    startPipeSpawning();
}

function gameOver() {
    gameState = "gameover";
    bgm.pause();
    bgm.currentTime = 0;
    stopPipeSpawning();
    setTimeout(() => showQuestion(), 500);
}

function startPipeSpawning() {
    if (pipeInterval) clearInterval(pipeInterval);
    pipeInterval = setInterval(() => {
        if (gameState === "playing") {
            const topHeight = Math.random() * 250 + 50;
            pipes.push({
                x: canvas.width,
                top: topHeight,
                passed: false
            });
        }
    }, 2000);
}

function stopPipeSpawning() {
    if (pipeInterval) {
        clearInterval(pipeInterval);
        pipeInterval = null;
    }
}

function showQuestion() {
    if (awaitingQuestion) return;
    
    const available = questions.filter((q, i) => !askedQuestions.has(i));
    if (available.length === 0) {
        document.getElementById("questionText").innerText = "TEBRÄ°KLER! ğŸ‰\nTÃ¼m sorularÄ± cevapladÄ±n!";
        document.getElementById("options").innerHTML = "";
        document.getElementById("solution").innerHTML = "Sen gerÃ§ek bir matematik ÅŸampiyonusun! ğŸŒŸ";
        document.getElementById("questionBox").style.display = "flex";
        gameState = "menu";
        return;
    }
    
    awaitingQuestion = true;
    const index = Math.floor(Math.random() * available.length);
    currentQuestion = available[index];
    askedQuestions.add(questions.indexOf(currentQuestion));
    updateQuestionCounter();
    
    document.getElementById("questionText").innerText = currentQuestion.q;
    const optsDiv = document.getElementById("options");
    optsDiv.innerHTML = "";
    
    const correct = parseFloat(currentQuestion.ans);
    let choices = [correct];
    while (choices.length < 4) {
        let wrong;
        if (Number.isInteger(correct)) {
            wrong = correct + Math.floor(Math.random() * 7) - 3;
            if (wrong < 1) wrong = correct + 2;
        } else {
            wrong = (correct + (Math.random() * 4 - 2)).toFixed(1);
        }
        if (!choices.includes(parseFloat(wrong))) {
            choices.push(parseFloat(wrong));
        }
    }
    
    choices = choices.sort(() => Math.random() - 0.5);
    
    choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.className = "option";
        btn.innerText = choice;
        btn.onclick = () => checkAnswer(choice.toString());
        optsDiv.appendChild(btn);
    });
    
    document.getElementById("solution").innerText = "";
    document.getElementById("questionBox").style.display = "flex";
}

function checkAnswer(answer) {
    if (answer === currentQuestion.ans) {
        document.getElementById("questionBox").style.display = "none";
        gameState = "menu";
        awaitingQuestion = false;
    } else {
        document.getElementById("solution").innerHTML = "âŒ YanlÄ±ÅŸ!<br><br>" + currentQuestion.sol;
    }
}

/* =============== UPDATE =============== */
function update() {
    if (gameState !== "playing") return;
    
    // Bird fiziÄŸi
    bird.vy += GRAVITY;
    bird.y += bird.vy;
    bird.frame += 0.2;
    
    // Pipe'larÄ± gÃ¼ncelle (tersten dÃ¶ngÃ¼)
    for (let i = pipes.length - 1; i >= 0; i--) {
        const pipe = pipes[i];
        pipe.x -= 4;
        
        // Ã‡arpÄ±ÅŸma kontrolÃ¼
        const birdRight = bird.x + bird.width;
        const birdBottom = bird.y + bird.height;
        
        // Ãœst boru Ã§arpÄ±ÅŸmasÄ±
        if (birdRight > pipe.x && 
            bird.x < pipe.x + PIPE_WIDTH && 
            bird.y < pipe.top) {
            gameOver();
            return;
        }
        
        // Alt boru Ã§arpÄ±ÅŸmasÄ±
        if (birdRight > pipe.x && 
            bird.x < pipe.x + PIPE_WIDTH && 
            birdBottom > pipe.top + PIPE_GAP) {
            gameOver();
            return;
        }
        
        // Skor kontrolÃ¼
        if (!pipe.passed && pipe.x + PIPE_WIDTH < bird.x) {
            score++;
            pipe.passed = true;
        }
        
        // Pipe'Ä± kaldÄ±r
        if (pipe.x + PIPE_WIDTH < 0) {
            pipes.splice(i, 1);
        }
    }
    
    // Yerden Ã§Ä±kma kontrolÃ¼
    if (bird.y + bird.height > canvas.height - 50 || bird.y < 0) {
        gameOver();
    }
}

/* =============== DRAW =============== */
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Arkaplan
    ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
    
    // Pipe'lar (DÃœZELTÄ°LDÄ° - ÅŸimdi doÄŸru gÃ¶rÃ¼necek)
    pipes.forEach(pipe => {
        // Ãœst pipe (normal)
        ctx.save();
        ctx.drawImage(pipeImg, pipe.x, pipe.top - 320, PIPE_WIDTH, 320);
        ctx.restore();
        
        // Alt pipe (ters - ÅŸimdi doÄŸru ÅŸekilde ters dÃ¶ndÃ¼)
        ctx.save();
        ctx.translate(pipe.x + PIPE_WIDTH/2, pipe.top + PIPE_GAP);
        ctx.scale(1, -1);
        ctx.drawImage(pipeImg, -PIPE_WIDTH/2, -320, PIPE_WIDTH, 320);
        ctx.restore();
    });
    
    // KuÅŸ
    if (gameState !== "menu") {
        const frameIndex = Math.floor(bird.frame) % 3;
        ctx.drawImage(birdFrames[frameIndex], bird.x, bird.y, bird.width, bird.height);
    }
    
    // Zemin
    ctx.drawImage(baseImg, 0, canvas.height - 50, canvas.width, 50);
    
    // MenÃ¼ mesajÄ±
    if (gameState === "menu") {
        ctx.drawImage(messageImg, canvas.width/2 - 110, canvas.height/2 - 60, 220, 120);
    }
    
    // Gameover mesajÄ±
    if (gameState === "gameover") {
        ctx.drawImage(gameoverImg, canvas.width/2 - 120, canvas.height/2 - 60, 240, 120);
    }
    
    // Skor
    const scoreStr = score.toString();
    let offset = 0;
    for (let i = 0; i < scoreStr.length; i++) {
        const digit = scoreStr[i];
        if (scoreSprites[digit]) {
            const x = canvas.width/2 - (scoreStr.length * 30)/2 + offset;
            ctx.drawImage(scoreSprites[digit], x, 20, 30, 50);
        }
        offset += 30;
    }
}

/* =============== GAME LOOP =============== */
function gameLoop() {
    if (!gameLoopRunning) return;
    update();
    draw();
    animationFrame = requestAnimationFrame(gameLoop);
}

/* =============== TEMÄ°ZLÄ°K =============== */
window.addEventListener('beforeunload', () => {
    if (animationFrame) {
        cancelAnimationFrame(animationFrame);
    }
    stopPipeSpawning();
    gameLoopRunning = false;
});

// Soru sayacÄ±nÄ± baÅŸlat
updateQuestionCounter();

// Oyunu baÅŸlat
gameLoopRunning = true;
gameLoop();
</script>
</body>
</html>
