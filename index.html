<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Math Edition</title>
<style>
body{
    margin:0;
    overflow:hidden;
    font-family:Arial;
    background:black;
}
canvas{
    display:block;
}

#intro{
    position:fixed;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:5em;
    color:yellow;
    font-weight:bold;
    background:black;
}

#questionBox{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.95);
    display:none;
    justify-content:center;
    align-items:flex-start;
    flex-direction:column;
    gap:15px;
    text-align:center;
    padding-top:50px;
}

#questionText{
    color:white;
    font-size:1.5em;
    margin-bottom:20px;
    max-width:80%;
}

.answers{
    display:flex;
    flex-direction:column;
    gap:10px;
}

.answers button{
    padding:12px 25px;
    font-size:1.1em;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#444;
    color:white;
}

#solution{
    color:yellow;
    margin-top:15px;
    font-size:1.1em;
}

#userMessage{
    margin-top:20px;
    padding:8px;
    width:200px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="intro">ByOmerAsaf</div>

<div id="questionBox">
    <h2 id="questionText"></h2>
    <div class="answers">
        <button id="btn1" onclick="checkAnswer(this)">A</button>
        <button id="btn2" onclick="checkAnswer(this)">B</button>
        <button id="btn3" onclick="checkAnswer(this)">C</button>
        <button id="btn4" onclick="checkAnswer(this)">D</button>
    </div>
    <input id="userMessage" placeholder="Mesajınızı yazın...">
    <p id="solution"></p>
</div>

<audio id="bgMusic" loop autoplay>
    <source src="88.m4a" type="audio/m4a">
</audio>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function resizeCanvas(){
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

/* ================= IMAGE LOADER ================= */
function load(name){ let img=new Image(); img.src="sprites/"+name; return img; }

const bg=load("background-day.png");
const baseImg=load("base.png");
const pipeImg=load("pipe-green.png");
const messageImg=load("message.png");
const gameoverImg=load("gameover.png");

const birdFrames=[
    load("yellowbird-upflap.png"),
    load("yellowbird-midflap.png"),
    load("yellowbird-downflap.png")
];

/* ================= SCORE PNG ================= */
const scoreDigits={
    "0": load("00000.png"),
    "1": load("111.png"),
    "2": load("99999.png"),
    "3": load("33.png"),
    "4": load("44.png"),
    "5": load("55.png"),
    "6": load("66.png"),
    "7": load("77.png"),
    "8": load("88.png"),
    "9": load("99.png")
};

/* ================= QUESTIONS ================= */
const questions=[
    {
        q:"Ali, 6 işçiyle bir işi 12 günde tamamlıyor. Eğer işçi sayısı 3 katına çıkarılırsa işi kaç günde bitirir? Bu hesaplamada işçiler eşit şekilde çalışıyor.",
        options:["4","6","12","8"],
        ans:"4",
        sol:"İşçi sayısı 3 katına çıkarsa süre 3 kat azalır. 12/3=4"
    },
    {
        q:"Bir araba 240 km yolu 4 saatte gidiyor. Aynı hızla 360 km yolu kaç saatte gider?",
        options:["4","5","6","7"],
        ans:"6",
        sol:"360/240*4=6 saat"
    },
    {
        q:"Bir işçi bir fabrikada 8 saatte 160 ürün üretiyor. 4 işçi aynı hızda çalışırsa 8 saatte kaç ürün üretir?",
        options:["320","480","160","400"],
        ans:"640",
        sol:"4 işçi 8 saatte 4*160=640 ürün üretir"
    },
    {
        q:"5 kişi bir işi 20 günde bitiriyor. Eğer kişi sayısı 10 olursa aynı iş kaç günde biter?",
        options:["10","15","20","25"],
        ans:"10",
        sol:"Kişi sayısı 2 katına çıkarsa süre yarıya iner. 20/2=10"
    },
    {
        q:"Bir depoda 12 işçi 18 günde çalışıyor. 6 işçi çalışırsa aynı işi kaç günde bitirir?",
        options:["18","24","36","12"],
        ans:"36",
        sol:"İşçi sayısı yarıya düşerse süre 2 katına çıkar. 18*2=36"
    },
    {
        q:"Bir fabrikada 9 işçi 27 günde bir ürün üretiyor. İşçi sayısı 3 katına çıkarsa ürün kaç günde üretilir?",
        options:["9","27","12","15"],
        ans:"9",
        sol:"27/3=9"
    }
];

let usedQuestions=[];
let currentQuestion=null;

/* ================= GAME VARIABLES ================= */
let bird={x:0.2*canvas.width,y:0.4*canvas.height,vy:0,frame:0};
let pipes=[];
let state="intro";
let score=0;

/* ================= INTRO ================= */
const introDiv=document.getElementById("intro");
let introTime=0;
function introLoop(){
    introTime++;
    introDiv.style.opacity=Math.min(introTime/60,1);
    if(introTime<180){
        requestAnimationFrame(introLoop);
    }else{
        state="menu";
        introDiv.style.display="none";
    }
}
introLoop();

/* ================= INPUT ================= */
canvas.addEventListener("click",()=>{
    if(state==="menu"){
        resetGame();
        state="play";
        bird.vy=-7;
        return;
    }
    if(state==="play"){
        bird.vy=-7;
    }
});

/* ================= GAME FUNCTIONS ================= */
function resetGame(){
    pipes=[];
    bird.y=0.4*canvas.height;
    bird.vy=0;
    score=0;
}

function spawnPipe(){
    let top=Math.random()*(canvas.height*0.5)+50;
    pipes.push({x:canvas.width,top,scored:false});
}
setInterval(()=>{ if(state==="play") spawnPipe(); },2000);

/* ================= QUESTIONS ================= */
function askQuestion(){
    if(usedQuestions.length>=questions.length) return;
    do{
        currentQuestion=questions[Math.floor(Math.random()*questions.length)];
    }while(usedQuestions.includes(currentQuestion));
    usedQuestions.push(currentQuestion);

    document.getElementById("questionText").innerText=currentQuestion.q;
    const btns=document.querySelectorAll(".answers button");
    currentQuestion.options.forEach((opt,i)=>{
        btns[i].innerText=opt;
    });
    document.getElementById("solution").innerText="";
    document.getElementById("userMessage").value="";
    document.getElementById("questionBox").style.display="flex";
}

function checkAnswer(btn){
    if(btn.innerText===currentQuestion.ans){
        document.getElementById("questionBox").style.display="none";
        countdownStart();
    }else{
        document.getElementById("solution").innerText="Yanlış! "+currentQuestion.sol;
        setTimeout(()=>{
            document.getElementById("questionBox").style.display="none";
            resetGame();
            state="menu";
        },3000);
    }
}

/* ================= COUNTDOWN ================= */
function countdownStart(){
    let count=3;
    state="countdown";
    const countdownInterval=setInterval(()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(bg,0,0,canvas.width,canvas.height);
        ctx.fillStyle="white";
        ctx.font=`${Math.floor(canvas.height*0.2)}px Arial`;
        ctx.textAlign="center";
        ctx.fillText(count,canvas.width/2,canvas.height/2);
        count--;
        if(count<0){
            clearInterval(countdownInterval);
            resetGame();
            state="play";
        }
    },1000);
}

/* ================= UPDATE ================= */
function update(){
    if(state!=="play") return;
    bird.vy+=0.4;
    bird.y+=bird.vy;
    bird.frame+=0.2;

    pipes.forEach(p=>{
        p.x-=2;
        if(bird.x+canvas.width*0.05>p.x &&
           bird.x<p.x+canvas.width*0.07 &&
           (bird.y<p.top || bird.y+canvas.height*0.06>p.top+canvas.height*0.28)
        ){
            state="gameover";
            setTimeout(()=>{ askQuestion(); },500);
        }
        if(!p.scored && p.x+canvas.width*0.07<bird.x){
            score++;
            p.scored=true;
        }
    });
    if(bird.y>canvas.height-50 || bird.y<0){
        state="gameover";
        setTimeout(()=>{ askQuestion(); },500);
    }
}

/* ================= DRAW ================= */
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(bg,0,0,canvas.width,canvas.height);

    pipes.forEach(p=>{
        ctx.drawImage(pipeImg,p.x,p.top-320,canvas.width*0.07,320);
        ctx.drawImage(pipeImg,p.x,p.top+canvas.height*0.14,canvas.width*0.07,320);
    });

    if(state!=="menu" && state!=="countdown"){
        ctx.drawImage(birdFrames[Math.floor(bird.frame)%3],bird.x,bird.y,canvas.width*0.05,canvas.height*0.06);
    }

    ctx.drawImage(baseImg,0,canvas.height-50,canvas.width,50);

    if(state==="menu"){
        ctx.drawImage(messageImg,canvas.width/2-110,canvas.height/2-60,220,120);
    }

    if(state==="gameover"){
        ctx.drawImage(gameoverImg,canvas.width/2-120,canvas.height/2-60,240,120);
    }

    drawScore();
}

/* ================= DRAW SCORE ================= */
function drawScore(){
    let s=score.toString();
    for(let i=0;i<s.length;i++){
        let d=s[i];
        if(scoreDigits[d])
            ctx.drawImage(scoreDigits[d], 20+i*50, 20, 50, 50);
    }
}

/* ================= LOOP ================= */
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
