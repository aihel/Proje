<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Math Edition</title>
<style>
body{
    margin:0;
    overflow:hidden;
    font-family:Arial;
    background:black;
}
canvas{
    display:block;
}
#intro{
    position:fixed;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:5em;
    color:yellow;
    font-weight:bold;
    background:black;
}
#questionBox{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.9);
    display:none;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    gap:20px;
    text-align:center;
}
input{
    padding:10px;
    width:180px;
    text-align:center;
    font-size:1.2em;
}
button{
    padding:10px 25px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="intro">ByOmerAsaf</div>

<div id="questionBox">
    <h2 id="questionText"></h2>
    <input id="answerInput" placeholder="Cevap">
    <button onclick="checkAnswer()">Kontrol</button>
    <p id="solution"></p>
</div>

<audio id="bgMusic" loop autoplay>
    <source src="88.m4a" type="audio/m4a">
</audio>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function resizeCanvas(){
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

/* ================= IMAGE LOADER ================= */
function load(name){ let img=new Image(); img.src="sprites/"+name; return img; }

const bg=load("background-day.png");
const baseImg=load("base.png");
const pipeImg=load("pipe-green.png");
const messageImg=load("message.png");
const gameoverImg=load("gameover.png");

const birdFrames=[
    load("yellowbird-upflap.png"),
    load("yellowbird-midflap.png"),
    load("yellowbird-downflap.png")
];

/* ================= SCORE PNG ================= */
const scoreDigits={
    "0": load("00000.png"),
    "1": load("111.png"),
    "2": load("99999.png"),
    "3": load("33.png"),
    "4": load("44.png"),
    "5": load("55.png"),
    "6": load("66.png"),
    "7": load("77.png"),
    "8": load("88.png"),
    "9": load("99.png")
};

/* ================= QUESTIONS ================= */
const questions=[];
for(let i=0;i<90;i++){
    let a=Math.floor(Math.random()*8)+2;
    let b=Math.floor(Math.random()*9)+1;
    questions.push({
        q:`${a} işçi bir işi ${b*2} günde yapıyor. İşçi sayısı ${a*2} olursa kaç günde biter?`,
        ans:`${b}`,
        sol:`İşçi sayısı artarsa süre azalır. Cevap: ${b}`
    });
}
let usedQuestions=[];
let currentQuestion=null;

/* ================= GAME VARIABLES ================= */
let bird={x:0.2*canvas.width,y:0.4*canvas.height,vy:0,frame:0};
let pipes=[];
let state="intro";
let score=0;

/* ================= INTRO ================= */
const introDiv=document.getElementById("intro");
let introTime=0;
function introLoop(){
    introTime++;
    introDiv.style.opacity=Math.min(introTime/60,1);
    if(introTime<180){ // 3 saniye
        requestAnimationFrame(introLoop);
    }else{
        state="menu";
        introDiv.style.display="none";
    }
}
introLoop();

/* ================= INPUT ================= */
canvas.addEventListener("click",()=>{
    if(state==="menu"){
        resetGame();
        state="play";
        bird.vy=-7;
        return;
    }
    if(state==="play"){
        bird.vy=-7;
    }
});

/* ================= GAME FUNCTIONS ================= */
function resetGame(){
    pipes=[];
    bird.y=0.4*canvas.height;
    bird.vy=0;
    score=0;
}

function spawnPipe(){
    let top=Math.random()*(canvas.height*0.5)+50;
    pipes.push({x:canvas.width,top,scored:false});
}
setInterval(()=>{ if(state==="play") spawnPipe(); },2000);

/* ================= QUESTIONS ================= */
function askQuestion(){
    if(usedQuestions.length>=questions.length) return;
    do{
        currentQuestion=questions[Math.floor(Math.random()*questions.length)];
    }while(usedQuestions.includes(currentQuestion));
    usedQuestions.push(currentQuestion);

    document.getElementById("questionText").innerText=currentQuestion.q;
    document.getElementById("solution").innerText="";
    document.getElementById("answerInput").value="";
    document.getElementById("questionBox").style.display="flex";
}

function checkAnswer(){
    const val=document.getElementById("answerInput").value;
    if(val===currentQuestion.ans){
        document.getElementById("questionBox").style.display="none";
        countdownStart();
    }else{
        document.getElementById("solution").innerText="Yanlış! "+currentQuestion.sol;
        setTimeout(()=>{
            document.getElementById("questionBox").style.display="none";
            resetGame();
            state="menu";
        },2000);
    }
}

/* ================= COUNTDOWN ================= */
function countdownStart(){
    let count=3;
    state="countdown";
    const countdownInterval=setInterval(()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(bg,0,0,canvas.width,canvas.height);
        ctx.fillStyle="white";
        ctx.font=`${Math.floor(canvas.height*0.2)}px Arial`;
        ctx.textAlign="center";
        ctx.fillText(count,canvas.width/2,canvas.height/2);
        count--;
        if(count<0){
            clearInterval(countdownInterval);
            resetGame();
            state="play";
        }
    },1000);
}

/* ================= UPDATE ================= */
function update(){
    if(state!=="play") return;
    bird.vy+=0.4;
    bird.y+=bird.vy;
    bird.frame+=0.2;

    pipes.forEach(p=>{
        p.x-=2;
        if(bird.x+canvas.width*0.05>p.x &&
           bird.x<p.x+canvas.width*0.07 &&
           (bird.y<p.top || bird.y+canvas.height*0.06>p.top+canvas.height*0.28)
        ){
            state="gameover";
            setTimeout(()=>{ askQuestion(); },500);
        }
        if(!p.scored && p.x+canvas.width*0.07<bird.x){
            score++;
            p.scored=true;
        }
    });
    if(bird.y>canvas.height-50 || bird.y<0){
        state="gameover";
        setTimeout(()=>{ askQuestion(); },500);
    }
}

/* ================= DRAW ================= */
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(bg,0,0,canvas.width,canvas.height);

    pipes.forEach(p=>{
        ctx.drawImage(pipeImg,p.x,p.top-320,canvas.width*0.07,320);
        ctx.drawImage(pipeImg,p.x,p.top+canvas.height*0.14,canvas.width*0.07,320);
    });

    if(state!=="menu" && state!=="countdown"){
        ctx.drawImage(birdFrames[Math.floor(bird.frame)%3],bird.x,bird.y,canvas.width*0.05,canvas.height*0.06);
    }

    ctx.drawImage(baseImg,0,canvas.height-50,canvas.width,50);

    if(state==="menu"){
        ctx.drawImage(messageImg,canvas.width/2-110,canvas.height/2-60,220,120);
    }

    if(state==="gameover"){
        ctx.drawImage(gameoverImg,canvas.width/2-120,canvas.height/2-60,240,120);
    }

    drawScore();
}

/* ================= DRAW SCORE ================= */
function drawScore(){
    let s=score.toString();
    for(let i=0;i<s.length;i++){
        let d=s[i];
        if(scoreDigits[d])
            ctx.drawImage(scoreDigits[d], 20+i*50, 20, 50, 50);
    }
}

/* ================= LOOP ================= */
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
