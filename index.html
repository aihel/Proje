<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE NEWS + FLAPPY BIRD (By Omer Asaf)</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
html,body{width:100%;height:100%;overflow:hidden;background:#000;}
canvas{display:block;margin:0 auto;background:#87CEEB;} /* Gökyüzü */
#splash{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;flex-direction:column;background:#000;color:white;font-size:4em;animation:fadeInOut 3s forwards;z-index:1000;}
@keyframes fadeInOut{0%{opacity:0;transform:scale(0.5);}50%{opacity:1;transform:scale(1.1);}100%{opacity:0;transform:scale(1);}}
#scoreDisplay{position:absolute;top:10px;right:20px;color:white;font-size:2em;z-index:1001;}
#mathQuestion{position:absolute;top:10%;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.7);color:white;padding:20px;border-radius:15px;display:none;max-width:80%;text-align:center;font-size:1.8em;z-index:1002;}
#answerInput{margin-top:10px;font-size:1.5em;padding:8px;border-radius:10px;border:none;}
#feedback{margin-top:10px;font-size:1.4em;color:yellow;}
</style>
</head>
<body>

<div id="splash">By Omer Asaf</div>

<div id="scoreDisplay">Score: 0</div>
<div id="mathQuestion">
    <div id="questionText"></div>
    <input type="number" id="answerInput" placeholder="Cevabı gir"/>
    <div id="feedback"></div>
</div>

<audio id="bgMusic" src="assets/88.m4a" loop autoplay></audio>
<canvas id="gameCanvas"></canvas>

<script>
// --- SPLASH ---
setTimeout(() => { document.getElementById('splash').style.display='none'; startGame(); }, 3000);

// --- FLAPPY BIRD AYARLARI ---
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let bird={x:150,y:canvas.height/2,width:40,height:40,dy:0};
const gravity=0.7;
const jump=-12;
let pipes=[],pipeWidth=80,pipeGap=200,frame=0,score=0;
let gameOver=false;

// --- MATEMATİK SORULARI ---
let mathQuestions=[];
for(let i=1;i<=90;i++){
    let a=Math.floor(Math.random()*20)+1;
    let b=Math.floor(Math.random()*20)+1;
    let op=['+','-','*'][Math.floor(Math.random()*3)];
    let q=`${a} ${op} ${b}`;
    let ans=eval(q);
    mathQuestions.push({q:q,ans:ans});
}
let currentQuestion=0;

// --- GAME FUNCTIONS ---
function startGame(){
    bird.y=canvas.height/2; bird.dy=0; pipes=[]; score=0; gameOver=false;
    showMathQuestion();
    requestAnimationFrame(gameLoop);
}

function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // --- MATEMATİK SORUSU ---
    if(document.getElementById('mathQuestion').style.display=='block'){
        requestAnimationFrame(gameLoop);
        return;
    }

    // --- FLAPPY ---
    bird.dy+=gravity;
    bird.y+=bird.dy;
    ctx.fillStyle='yellow';
    ctx.fillRect(bird.x,bird.y,bird.width,bird.height);

    // --- PIPES ---
    if(frame%100===0){
        let pipeY=Math.random()*(canvas.height-pipeGap-200)+100;
        pipes.push({x:canvas.width,y:pipeY});
    }
    ctx.fillStyle='green';
    for(let i=0;i<pipes.length;i++){
        let p=pipes[i];
        p.x-=4;
        ctx.fillRect(p.x,0,pipeWidth,p.y);
        ctx.fillRect(p.x,p.y+pipeGap,pipeWidth,canvas.height-p.y-pipeGap);

        // çarpışma
        if(bird.x+bird.width>p.x && bird.x< p.x+pipeWidth && (bird.y<p.y || bird.y+bird.height>p.y+pipeGap)){
            gameOver=true;
        }
        if(p.x+pipeWidth<bird.x && !p.passed){score++;p.passed=true;}
    }

    // --- GAMEOVER ---
    if(bird.y+bird.height>canvas.height || bird.y<0) gameOver=true;
    document.getElementById('scoreDisplay').innerText='Score: '+score;

    if(gameOver){ showMathQuestion(); return; }

    frame++;
    requestAnimationFrame(gameLoop);
}

// --- JUMP ---
document.addEventListener('keydown',e=>{ if(e.code==='Space') bird.dy=jump; });

// --- MATEMATİK SORUSU LOGİĞİ ---
function showMathQuestion(){
    if(currentQuestion>=mathQuestions.length){ currentQuestion=0; }
    let mq=document.getElementById('mathQuestion');
    mq.style.display='block';
    let qobj=mathQuestions[currentQuestion];
    document.getElementById('questionText').innerText=`Soru: ${qobj.q}`;
    document.getElementById('answerInput').value='';
    document.getElementById('feedback').innerText='';
    document.getElementById('answerInput').focus();
}

document.getElementById('answerInput').addEventListener('keydown',function(e){
    if(e.key==='Enter'){
        let ans=parseFloat(this.value);
        let correct=mathQuestions[currentQuestion].ans;
        let feedback=document.getElementById('feedback');
        if(ans===correct){
            feedback.style.color='lightgreen';
            feedback.innerText='✅ Doğru! 3 saniye sonra oyun başlıyor';
            setTimeout(()=>{ document.getElementById('mathQuestion').style.display='none'; currentQuestion++; startGame(); },3000);
        } else {
            feedback.style.color='red';
            feedback.innerText=`❌ Yanlış! Doğru cevap: ${correct}`;
        }
    }
});
</script>
</body>
</html>
